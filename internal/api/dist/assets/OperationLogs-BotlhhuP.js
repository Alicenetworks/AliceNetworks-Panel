import{aE as B}from"./index-ZJAELyGg.js";import{T as E,E as I}from"./TableSkeleton-CpNcW2pL.js";import{R as P}from"./RefreshOutline-BlwU_6pp.js";import{k as R,o as V,Z as j,Y as l,W as n,V as i,r as u,X as d,U as v,a2 as D,j as A,N as f,m as b}from"./vue-vendor-CGi32OHI.js";import{N as F,e as h}from"./naive-ui-B4L8VU6X.js";import"./index-3OKNQTir.js";import"./SwapHorizontalOutline-BSqMGymv.js";import"./ServerOutline-CH8la6EY.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const J={class:"operation-logs"},$=R({__name:"OperationLogs",setup(W){const o=u(!1),c=u([]),p=u(null),g=u(null),a=u({page:1,pageSize:20,itemCount:0,showSizePicker:!0,pageSizes:[20,50,100]}),k=[{label:"登录",value:"login"},{label:"创建",value:"create"},{label:"更新",value:"update"},{label:"删除",value:"delete"},{label:"同步",value:"sync"}],w=[{label:"用户",value:"user"},{label:"节点",value:"node"},{label:"客户端",value:"client"},{label:"端口转发",value:"port_forward"},{label:"节点组",value:"node_group"},{label:"隧道",value:"tunnel"},{label:"通知渠道",value:"notify_channel"},{label:"告警规则",value:"alert_rule"}],S=e=>!e||e.startsWith("0001")?"-":new Date(e).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"}),z=e=>({login:{type:"info",label:"登录"},create:{type:"success",label:"创建"},update:{type:"warning",label:"更新"},delete:{type:"error",label:"删除"},sync:{type:"info",label:"同步"}})[e]||{type:"default",label:e},N=e=>({user:"用户",node:"节点",client:"客户端",port_forward:"端口转发",node_group:"节点组",tunnel:"隧道",notify_channel:"通知渠道",alert_rule:"告警规则",proxy_chain:"代理链"})[e]||e,C=[{title:"ID",key:"id",width:60},{title:"时间",key:"created_at",width:170,render:e=>S(e.created_at)},{title:"用户",key:"username",width:100},{title:"操作",key:"action",width:80,render:e=>{const t=z(e.action);return b(h,{type:t.type,size:"small"},()=>t.label)}},{title:"资源",key:"resource",width:100,render:e=>N(e.resource)},{title:"资源ID",key:"resource_id",width:80,render:e=>e.resource_id||"-"},{title:"状态",key:"status",width:80,render:e=>b(h,{type:e.status==="success"?"success":"error",size:"small"},()=>e.status==="success"?"成功":"失败")},{title:"IP",key:"ip",width:130},{title:"详情",key:"detail",ellipsis:{tooltip:!0},render:e=>{if(!e.detail)return"-";try{const t=JSON.parse(e.detail);return JSON.stringify(t)}catch{return e.detail}}}],r=async()=>{o.value=!0;try{const e=(a.value.page-1)*a.value.pageSize,t=await B({limit:a.value.pageSize,offset:e,action:p.value||void 0,resource:g.value||void 0});c.value=t.logs||[],a.value.itemCount=t.total||0}catch(e){console.error("Failed to load operation logs",e)}finally{o.value=!1}},x=e=>{a.value.page=e,r()},O=e=>{a.value.pageSize=e,a.value.page=1,r()},m=()=>{a.value.page=1,r()};return V(()=>{r()}),(e,t)=>{const y=i("n-select"),T=i("n-button"),_=i("n-space"),L=i("n-data-table"),U=i("n-card");return d(),j("div",J,[l(U,null,{header:n(()=>[l(_,{justify:"space-between",align:"center"},{default:n(()=>[t[3]||(t[3]=D("span",null,"操作日志",-1)),l(_,null,{default:n(()=>[l(y,{value:p.value,"onUpdate:value":[t[0]||(t[0]=s=>p.value=s),m],options:k,placeholder:"操作类型",clearable:"",style:{width:"120px"}},null,8,["value"]),l(y,{value:g.value,"onUpdate:value":[t[1]||(t[1]=s=>g.value=s),m],options:w,placeholder:"资源类型",clearable:"",style:{width:"120px"}},null,8,["value"]),l(T,{onClick:r},{icon:n(()=>[l(f(F),null,{default:n(()=>[l(f(P))]),_:1})]),default:n(()=>[t[2]||(t[2]=A(" 刷新 ",-1))]),_:1})]),_:1})]),_:1})]),default:n(()=>[o.value&&c.value.length===0?(d(),v(E,{key:0,rows:10})):!o.value&&c.value.length===0?(d(),v(I,{key:1,title:"暂无操作日志",description:"系统会自动记录用户操作"})):(d(),v(L,{key:2,columns:C,data:c.value,loading:o.value,"row-key":s=>s.id,pagination:a.value,remote:"","onUpdate:page":x,"onUpdate:pageSize":O},null,8,["data","loading","row-key","pagination"]))]),_:1})])}}});export{$ as default};
