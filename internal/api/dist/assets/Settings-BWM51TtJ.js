import{ay as V,az as G,aA as M,aB as F,aC as I,aD as Y}from"./index-ZJAELyGg.js";import{k as J,o as W,Z as O,Y as l,W as t,V as f,r as m,X as q,j as u,_ as X,a2 as b,a4 as Z}from"./vue-vendor-CGi32OHI.js";import{u as H,f as K}from"./naive-ui-B4L8VU6X.js";import"./index-3OKNQTir.js";const Q={class:"settings"},h=["src"],ee=["src"],ue=J({__name:"Settings",setup(le){const v=H(),T=K(),y=m(!1),g=m(!1),x=m(!1),w=m(!1),U=m(!1),k=m("all"),j=[{label:"全部",value:"all"},{label:"仅节点",value:"nodes"},{label:"仅客户端",value:"clients"}],D=[{label:"普通用户",value:"user"},{label:"只读用户",value:"viewer"}],a=m({site_name:"",site_description:"",site_url:"",favicon_url:"",logo_url:"",footer_text:"",custom_css:"",registration_enabled:!1,email_verification_required:!0,default_role:"user",agent_auto_update:!0,agent_force_update:!1}),$=async()=>{try{const n=await V();a.value={site_name:n.site_name||"",site_description:n.site_description||"",site_url:n.site_url||"",favicon_url:n.favicon_url||"",logo_url:n.logo_url||"",footer_text:n.footer_text||"",custom_css:n.custom_css||"",registration_enabled:n.registration_enabled==="true",email_verification_required:n.email_verification_required!=="false",default_role:n.default_role||"user",agent_auto_update:n.agent_auto_update!=="false",agent_force_update:n.agent_force_update==="true"}}catch{v.error("加载配置失败")}},z=async()=>{y.value=!0;try{const n={...a.value,registration_enabled:a.value.registration_enabled?"true":"false",email_verification_required:a.value.email_verification_required?"true":"false",agent_auto_update:a.value.agent_auto_update?"true":"false",agent_force_update:a.value.agent_force_update?"true":"false"};await G(n),v.success("设置已保存，刷新页面生效"),document.title=a.value.site_name||"GOST Panel";const e=document.querySelector('link[rel="icon"]');e&&a.value.favicon_url&&(e.href=a.value.favicon_url)}catch{v.error("保存失败")}finally{y.value=!1}},B=n=>{n.target.style.display="none"},S=async n=>{g.value=!0;try{const e=await M(n,k.value),i=new Blob([e],{type:n==="yaml"?"application/x-yaml":"application/json"}),s=window.URL.createObjectURL(i),r=document.createElement("a");r.href=s,r.download=`gost-panel-export.${n}`,document.body.appendChild(r),r.click(),window.URL.revokeObjectURL(s),document.body.removeChild(r),v.success("导出成功")}catch{v.error("导出失败")}finally{g.value=!1}},A=async({file:n})=>{x.value=!0;try{const e=await F(n.file),i=`导入完成: 节点 ${e.nodes_created} 个创建, ${e.nodes_skipped} 个跳过; 客户端 ${e.clients_created} 个创建, ${e.clients_skipped} 个跳过`;v.success(i)}catch{v.error("导入失败")}finally{x.value=!1}},E=async()=>{w.value=!0;try{const n=await I(),e=new Blob([n],{type:"application/octet-stream"}),i=window.URL.createObjectURL(e),s=document.createElement("a");s.href=i,s.download=`gost-panel-backup-${new Date().toISOString().slice(0,10)}.db`,document.body.appendChild(s),s.click(),window.URL.revokeObjectURL(i),document.body.removeChild(s),v.success("备份下载成功")}catch{v.error("备份失败")}finally{w.value=!1}},N=async({file:n})=>{T.warning({title:"确认恢复",content:"恢复备份将覆盖当前所有数据，此操作不可撤销。确定要继续吗？",positiveText:"确定恢复",negativeText:"取消",onPositiveClick:async()=>{U.value=!0;try{await Y(n.file),v.success("恢复成功，请重启服务以生效")}catch{v.error("恢复失败")}finally{U.value=!1}}})};return W(()=>{$()}),(n,e)=>{const i=f("n-button"),s=f("n-space"),r=f("n-divider"),_=f("n-input"),d=f("n-form-item"),c=f("n-switch"),p=f("n-text"),L=f("n-select"),P=f("n-form"),C=f("n-card"),R=f("n-upload");return q(),O("div",Q,[l(C,null,{header:t(()=>[l(s,{justify:"space-between",align:"center"},{default:t(()=>[e[16]||(e[16]=b("span",null,"网站设置",-1)),l(i,{type:"primary",loading:y.value,onClick:z},{default:t(()=>[...e[15]||(e[15]=[u(" 保存设置 ",-1)])]),_:1},8,["loading"])]),_:1})]),default:t(()=>[l(P,{model:a.value,"label-placement":"left","label-width":"140"},{default:t(()=>[l(r,null,{default:t(()=>[...e[17]||(e[17]=[u("基本信息",-1)])]),_:1}),l(d,{label:"网站名称"},{default:t(()=>[l(_,{value:a.value.site_name,"onUpdate:value":e[0]||(e[0]=o=>a.value.site_name=o),placeholder:"GOST Panel"},null,8,["value"])]),_:1}),l(d,{label:"网站描述"},{default:t(()=>[l(_,{value:a.value.site_description,"onUpdate:value":e[1]||(e[1]=o=>a.value.site_description=o),placeholder:"GOST 代理管理面板"},null,8,["value"])]),_:1}),l(d,{label:"网站 URL"},{default:t(()=>[l(_,{value:a.value.site_url,"onUpdate:value":e[2]||(e[2]=o=>a.value.site_url=o),placeholder:"https://your-domain.com (用于邮件链接)"},null,8,["value"])]),_:1}),l(r,null,{default:t(()=>[...e[18]||(e[18]=[u("用户注册",-1)])]),_:1}),l(d,{label:"开放注册"},{default:t(()=>[l(s,{vertical:""},{default:t(()=>[l(c,{value:a.value.registration_enabled,"onUpdate:value":e[3]||(e[3]=o=>a.value.registration_enabled=o)},null,8,["value"]),l(p,{depth:"3",style:{"font-size":"12px"}},{default:t(()=>[...e[19]||(e[19]=[u(" 启用后，新用户可以自行注册账户 ",-1)])]),_:1})]),_:1})]),_:1}),l(d,{label:"邮箱验证"},{default:t(()=>[l(s,{vertical:""},{default:t(()=>[l(c,{value:a.value.email_verification_required,"onUpdate:value":e[4]||(e[4]=o=>a.value.email_verification_required=o),disabled:!a.value.registration_enabled},null,8,["value","disabled"]),l(p,{depth:"3",style:{"font-size":"12px"}},{default:t(()=>[...e[20]||(e[20]=[u(" 启用后，用户必须验证邮箱才能登录（需先配置 SMTP） ",-1)])]),_:1})]),_:1})]),_:1}),l(d,{label:"默认角色"},{default:t(()=>[l(L,{value:a.value.default_role,"onUpdate:value":e[5]||(e[5]=o=>a.value.default_role=o),options:D,disabled:!a.value.registration_enabled,style:{width:"200px"}},null,8,["value","disabled"])]),_:1}),l(r,null,{default:t(()=>[...e[21]||(e[21]=[u("图标配置",-1)])]),_:1}),l(d,{label:"Favicon URL"},{default:t(()=>[l(_,{value:a.value.favicon_url,"onUpdate:value":e[6]||(e[6]=o=>a.value.favicon_url=o),placeholder:"/vite.svg 或 https://example.com/favicon.ico"},{prefix:t(()=>[a.value.favicon_url?(q(),O("img",{key:0,src:a.value.favicon_url,style:{width:"16px",height:"16px"},onError:B},null,40,h)):X("",!0)]),_:1},8,["value"])]),_:1}),l(d,{label:"Logo URL"},{default:t(()=>[l(_,{value:a.value.logo_url,"onUpdate:value":e[7]||(e[7]=o=>a.value.logo_url=o),placeholder:"留空使用默认，或输入图片URL"},null,8,["value"])]),_:1}),l(r,null,{default:t(()=>[...e[22]||(e[22]=[u("自定义内容",-1)])]),_:1}),l(d,{label:"页脚文字"},{default:t(()=>[l(_,{value:a.value.footer_text,"onUpdate:value":e[8]||(e[8]=o=>a.value.footer_text=o),placeholder:"可选，显示在页面底部"},null,8,["value"])]),_:1}),l(d,{label:"自定义 CSS"},{default:t(()=>[l(_,{value:a.value.custom_css,"onUpdate:value":e[9]||(e[9]=o=>a.value.custom_css=o),type:"textarea",placeholder:"可选，自定义样式",rows:4},null,8,["value"])]),_:1}),l(r,null,{default:t(()=>[...e[23]||(e[23]=[u("Agent 更新",-1)])]),_:1}),l(d,{label:"自动更新"},{default:t(()=>[l(s,{vertical:""},{default:t(()=>[l(c,{value:a.value.agent_auto_update,"onUpdate:value":e[10]||(e[10]=o=>a.value.agent_auto_update=o)},null,8,["value"]),l(p,{depth:"3",style:{"font-size":"12px"}},{default:t(()=>[...e[24]||(e[24]=[u(" 启用后，Agent 会在心跳时检查更新并提示 ",-1)])]),_:1})]),_:1})]),_:1}),l(d,{label:"强制更新"},{default:t(()=>[l(s,{vertical:""},{default:t(()=>[l(c,{value:a.value.agent_force_update,"onUpdate:value":e[11]||(e[11]=o=>a.value.agent_force_update=o),disabled:!a.value.agent_auto_update},null,8,["value","disabled"]),l(p,{depth:"3",style:{"font-size":"12px"}},{default:t(()=>[...e[25]||(e[25]=[u(" 启用后，所有 Agent 将在下次心跳时自动更新（更新后自动关闭） ",-1)])]),_:1})]),_:1})]),_:1}),l(d,{label:"当前 Agent 版本"},{default:t(()=>[l(p,null,{default:t(()=>[...e[26]||(e[26]=[u("v1.3.0",-1)])]),_:1})]),_:1})]),_:1},8,["model"]),l(r,null,{default:t(()=>[...e[27]||(e[27]=[u("预览",-1)])]),_:1}),l(s,{vertical:""},{default:t(()=>[l(p,null,{default:t(()=>[...e[28]||(e[28]=[u("浏览器标签预览:",-1)])]),_:1}),l(s,{align:"center"},{default:t(()=>[b("img",{src:a.value.favicon_url||"/vite.svg",style:{width:"20px",height:"20px"}},null,8,ee),l(p,{strong:""},{default:t(()=>[u(Z(a.value.site_name||"GOST Panel"),1)]),_:1})]),_:1})]),_:1})]),_:1}),l(C,{style:{"margin-top":"16px"}},{header:t(()=>[...e[29]||(e[29]=[b("span",null,"数据导出/导入",-1)])]),default:t(()=>[l(s,{vertical:""},{default:t(()=>[l(p,{depth:"3"},{default:t(()=>[...e[30]||(e[30]=[u("导出或导入节点和客户端配置，可用于备份或迁移。",-1)])]),_:1}),l(s,null,{default:t(()=>[l(L,{value:k.value,"onUpdate:value":e[12]||(e[12]=o=>k.value=o),options:j,style:{width:"140px"}},null,8,["value"]),l(i,{loading:g.value,onClick:e[13]||(e[13]=o=>S("json"))},{default:t(()=>[...e[31]||(e[31]=[u(" 导出 JSON ",-1)])]),_:1},8,["loading"]),l(i,{loading:g.value,onClick:e[14]||(e[14]=o=>S("yaml"))},{default:t(()=>[...e[32]||(e[32]=[u(" 导出 YAML ",-1)])]),_:1},8,["loading"]),l(r,{vertical:""}),l(R,{"show-file-list":!1,accept:".json,.yaml,.yml","custom-request":A},{default:t(()=>[l(i,{loading:x.value,type:"primary"},{default:t(()=>[...e[33]||(e[33]=[u(" 导入配置 ",-1)])]),_:1},8,["loading"])]),_:1})]),_:1}),l(p,{depth:"3",style:{"font-size":"12px"}},{default:t(()=>[...e[34]||(e[34]=[u(" 导入时同名节点/客户端会被跳过，不会覆盖现有数据。 ",-1)])]),_:1})]),_:1})]),_:1}),l(C,{style:{"margin-top":"16px"}},{header:t(()=>[...e[35]||(e[35]=[b("span",null,"数据库备份/恢复",-1)])]),default:t(()=>[l(s,{vertical:""},{default:t(()=>[l(p,{depth:"3"},{default:t(()=>[...e[36]||(e[36]=[u("备份完整数据库文件，包含所有配置和历史数据。",-1)])]),_:1}),l(s,null,{default:t(()=>[l(i,{loading:w.value,onClick:E},{default:t(()=>[...e[37]||(e[37]=[u(" 下载备份 ",-1)])]),_:1},8,["loading"]),l(R,{"show-file-list":!1,accept:".db","custom-request":N},{default:t(()=>[l(i,{loading:U.value,type:"warning"},{default:t(()=>[...e[38]||(e[38]=[u(" 恢复备份 ",-1)])]),_:1},8,["loading"])]),_:1})]),_:1}),l(p,{depth:"3",style:{"font-size":"12px",color:"#e88"}},{default:t(()=>[...e[39]||(e[39]=[u(" 注意：恢复备份后需要重启服务才能生效。 ",-1)])]),_:1})]),_:1})]),_:1})])}}});export{ue as default};
