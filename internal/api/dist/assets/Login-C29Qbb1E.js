import{k as R,o as U,Z as u,a2 as n,Y as s,W as r,r as d,V as l,a3 as q,X as i,_ as c,a4 as v,a5 as E,j as b,U as P}from"./vue-vendor-CGi32OHI.js";import{u as T}from"./user-DWVHXuGz.js";import{g as G,a as K}from"./index-ZJAELyGg.js";import{u as M}from"./naive-ui-B4L8VU6X.js";import{_ as O}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./index-3OKNQTir.js";const j={class:"login-container"},D={class:"login-header"},I=["src"],W={class:"login-title"},X={class:"login-subtitle"},Y={class:"login-links"},Z={key:0},z={key:0,class:"login-footer"},A=R({__name:"Login",setup(F){const y=q(),_=M(),m=T(),p=d(!1),f=d(!1),a=d({username:"",password:""}),t=d({site_name:"GOST Panel",site_description:"代理服务管理平台",logo_url:"",favicon_url:"",footer_text:""}),C={username:{required:!0,message:"请输入用户名"},password:{required:!0,message:"请输入密码"}},x=async()=>{try{const o=await K();if(t.value={...t.value,...o},o.site_name&&(document.title=o.site_name),o.favicon_url){let e=document.querySelector('link[rel="icon"]');e||(e=document.createElement("link"),e.rel="icon",document.head.appendChild(e)),e.href=o.favicon_url}}catch{}},k=async()=>{p.value=!0;try{await m.login(a.value.username,a.value.password),_.success("登录成功"),m.user&&!m.user.password_changed?(_.warning("首次登录请修改默认密码"),y.push("/change-password?force=1")):y.push("/")}catch(o){_.error(o.response?.data?.error||"登录失败")}finally{p.value=!1}};U(()=>{x(),V()});const V=async()=>{try{const o=await G();f.value=o.enabled}catch{}};return(o,e)=>{const w=l("n-input"),h=l("n-form-item"),B=l("n-button"),L=l("n-form"),S=l("router-link"),N=l("n-card");return i(),u("div",j,[e[5]||(e[5]=n("div",{class:"bg-orb orb-1"},null,-1)),e[6]||(e[6]=n("div",{class:"bg-orb orb-2"},null,-1)),e[7]||(e[7]=n("div",{class:"bg-orb orb-3"},null,-1)),s(N,{class:"login-card"},{default:r(()=>[n("div",D,[t.value.logo_url?(i(),u("img",{key:0,src:t.value.logo_url,class:"login-logo",alt:"Logo"},null,8,I)):c("",!0),n("h1",W,v(t.value.site_name||"GOST Panel"),1),n("p",X,v(t.value.site_description||"代理服务管理平台"),1)]),s(L,{ref:"formRef",model:a.value,rules:C},{default:r(()=>[s(h,{path:"username",label:"用户名"},{default:r(()=>[s(w,{value:a.value.username,"onUpdate:value":e[0]||(e[0]=g=>a.value.username=g),placeholder:"admin"},null,8,["value"])]),_:1}),s(h,{path:"password",label:"密码"},{default:r(()=>[s(w,{value:a.value.password,"onUpdate:value":e[1]||(e[1]=g=>a.value.password=g),type:"password",placeholder:"请输入密码",onKeyup:E(k,["enter"])},null,8,["value"])]),_:1}),s(B,{type:"primary",block:"",loading:p.value,onClick:k,class:"login-btn"},{default:r(()=>[...e[2]||(e[2]=[b(" 登录 ",-1)])]),_:1},8,["loading"])]),_:1},8,["model"]),n("div",Y,[s(S,{to:"/forgot-password"},{default:r(()=>[...e[3]||(e[3]=[b("忘记密码？",-1)])]),_:1}),f.value?(i(),u("span",Z,"|")):c("",!0),f.value?(i(),P(S,{key:1,to:"/register"},{default:r(()=>[...e[4]||(e[4]=[b("注册账户",-1)])]),_:1})):c("",!0)]),t.value.footer_text?(i(),u("div",z,v(t.value.footer_text),1)):c("",!0)]),_:1})])}}}),te=O(A,[["__scopeId","data-v-7ae7d739"]]);export{te as default};
