import{k as T,o as G,Z as m,a2 as n,Y as t,W as a,V as i,r as u,X as d,_ as R,a4 as S,N as V,j as p,U as K,a5 as O,a3 as $}from"./vue-vendor-CGi32OHI.js";import{a as j,g as D,r as I}from"./index-ZJAELyGg.js";import{u as L}from"./naive-ui-B4L8VU6X.js";import{_ as W}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./index-3OKNQTir.js";const X={class:"register-container"},Y={class:"register-header"},Z=["src"],h={class:"register-title"},z={key:0,class:"registration-disabled"},A={key:1,class:"registration-success"},F={class:"login-link"},H={key:3,class:"register-footer"},J=T({__name:"Register",setup(Q){const w=$(),b=L(),f=u(!1),y=u(!1),k=u(!0),C=u(!0),g=u(""),s=u({username:"",email:"",password:"",confirmPassword:""}),l=u({site_name:"GOST Panel",site_description:"代理服务管理平台",logo_url:"",favicon_url:"",footer_text:""}),q={username:[{required:!0,message:"请输入用户名"},{min:3,max:50,message:"用户名长度应为3-50个字符"}],email:[{required:!0,message:"请输入邮箱"},{type:"email",message:"请输入有效的邮箱地址"}],password:[{required:!0,message:"请输入密码"},{min:6,message:"密码至少6个字符"}],confirmPassword:[{required:!0,message:"请确认密码"},{validator:(o,e)=>e!==s.value.password?new Error("两次输入的密码不一致"):!0,trigger:["blur","input"]}]},N=async()=>{try{const o=await j();l.value={...l.value,...o},o.site_name&&(document.title=o.site_name+" - 注册")}catch{}},U=async()=>{try{const o=await D();k.value=o.enabled,C.value=o.email_verification}catch{}},P=async()=>{if(s.value.password!==s.value.confirmPassword){b.error("两次输入的密码不一致");return}f.value=!0;try{const o=await I(s.value.username,s.value.email,s.value.password);y.value=!0,o.email_verification?g.value="验证邮件已发送到您的邮箱，请查收并点击验证链接完成注册。":g.value="您的账户已创建，现在可以登录了。"}catch(o){b.error(o.response?.data?.error||"注册失败")}finally{f.value=!1}};return G(()=>{N(),U()}),(o,e)=>{const _=i("n-button"),x=i("n-result"),v=i("n-input"),c=i("n-form-item"),B=i("router-link"),E=i("n-form"),M=i("n-card");return d(),m("div",X,[e[12]||(e[12]=n("div",{class:"bg-orb orb-1"},null,-1)),e[13]||(e[13]=n("div",{class:"bg-orb orb-2"},null,-1)),e[14]||(e[14]=n("div",{class:"bg-orb orb-3"},null,-1)),t(M,{class:"register-card"},{default:a(()=>[n("div",Y,[l.value.logo_url?(d(),m("img",{key:0,src:l.value.logo_url,class:"register-logo",alt:"Logo"},null,8,Z)):R("",!0),n("h1",h,S(l.value.site_name||"GOST Panel"),1),e[6]||(e[6]=n("p",{class:"register-subtitle"},"创建新账户",-1))]),k.value?y.value?(d(),m("div",A,[t(x,{status:"success",title:C.value?"请验证邮箱":"注册成功",description:g.value},{footer:a(()=>[t(_,{type:"primary",onClick:e[1]||(e[1]=r=>V(w).push("/login"))},{default:a(()=>[...e[8]||(e[8]=[p("前往登录",-1)])]),_:1})]),_:1},8,["title","description"])])):(d(),K(E,{key:2,ref:"formRef",model:s.value,rules:q},{default:a(()=>[t(c,{path:"username",label:"用户名"},{default:a(()=>[t(v,{value:s.value.username,"onUpdate:value":e[2]||(e[2]=r=>s.value.username=r),placeholder:"请输入用户名 (至少3个字符)"},null,8,["value"])]),_:1}),t(c,{path:"email",label:"邮箱"},{default:a(()=>[t(v,{value:s.value.email,"onUpdate:value":e[3]||(e[3]=r=>s.value.email=r),placeholder:"user@example.com"},null,8,["value"])]),_:1}),t(c,{path:"password",label:"密码"},{default:a(()=>[t(v,{value:s.value.password,"onUpdate:value":e[4]||(e[4]=r=>s.value.password=r),type:"password",placeholder:"请输入密码 (至少6个字符)","show-password-on":"click"},null,8,["value"])]),_:1}),t(c,{path:"confirmPassword",label:"确认密码"},{default:a(()=>[t(v,{value:s.value.confirmPassword,"onUpdate:value":e[5]||(e[5]=r=>s.value.confirmPassword=r),type:"password",placeholder:"再次输入密码","show-password-on":"click",onKeyup:O(P,["enter"])},null,8,["value"])]),_:1}),t(_,{type:"primary",block:"",loading:f.value,onClick:P,class:"register-btn"},{default:a(()=>[...e[9]||(e[9]=[p(" 注册 ",-1)])]),_:1},8,["loading"]),n("div",F,[e[11]||(e[11]=p(" 已有账户？",-1)),t(B,{to:"/login"},{default:a(()=>[...e[10]||(e[10]=[p("立即登录",-1)])]),_:1})])]),_:1},8,["model"])):(d(),m("div",z,[t(x,{status:"warning",title:"注册已关闭",description:"当前不允许新用户注册，请联系管理员"},{footer:a(()=>[t(_,{onClick:e[0]||(e[0]=r=>V(w).push("/login"))},{default:a(()=>[...e[7]||(e[7]=[p("返回登录",-1)])]),_:1})]),_:1})])),l.value.footer_text?(d(),m("div",H,S(l.value.footer_text),1)):R("",!0)]),_:1})])}}}),le=W(J,[["__scopeId","data-v-a463b0ef"]]);export{le as default};
