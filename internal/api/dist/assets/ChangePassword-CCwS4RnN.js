import{k as S,X as m,Z as U,a2 as a,Y as r,W as o,V as t,U as x,j as _,_ as C,a5 as K,N as E,L as p,a4 as O,a3 as $,c as l,r as g,a6 as F}from"./vue-vendor-CGi32OHI.js";import{e as I}from"./index-ZJAELyGg.js";import{u as T}from"./user-DWVHXuGz.js";import{u as W}from"./naive-ui-B4L8VU6X.js";import{_ as X}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./index-3OKNQTir.js";const Y={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 512 512"},G=S({name:"LockClosedOutline",render:function(d,u){return m(),U("svg",Y,u[0]||(u[0]=[a("path",{d:"M336 208v-95a80 80 0 0 0-160 0v95",fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"32"},null,-1),a("rect",{x:"96",y:"208",width:"320",height:"272",rx:"48",ry:"48",fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"32"},null,-1)]))}}),H={class:"change-password-container"},J={class:"card-header"},Q={class:"password-tips"},ee=S({__name:"ChangePassword",setup(z){const d=$(),u=F(),h=W(),P=T(),i=l(()=>u.query.force==="1"),v=g(!1),k=g(),s=g({oldPassword:"",newPassword:"",confirmPassword:""}),B=l(()=>s.value.newPassword.length>=8),L=l(()=>/[A-Z]/.test(s.value.newPassword)),M=l(()=>/[a-z]/.test(s.value.newPassword)),N=l(()=>/[0-9]/.test(s.value.newPassword)),V={oldPassword:{required:!0,message:"请输入当前密码",trigger:"blur"},newPassword:[{required:!0,message:"请输入新密码",trigger:"blur"},{validator:(c,e)=>e.length<8?new Error("密码至少需要8个字符"):/[A-Z]/.test(e)?/[a-z]/.test(e)?/[0-9]/.test(e)?!0:new Error("密码需要包含数字"):new Error("密码需要包含小写字母"):new Error("密码需要包含大写字母"),trigger:"blur"}],confirmPassword:[{required:!0,message:"请确认新密码",trigger:"blur"},{validator:(c,e)=>e!==s.value.newPassword?new Error("两次输入的密码不一致"):!0,trigger:"blur"}]},y=async()=>{try{await k.value?.validate()}catch{return}v.value=!0;try{await I(s.value.oldPassword,s.value.newPassword),h.success("密码修改成功"),P.user&&(P.user.password_changed=!0),i.value?d.push("/"):d.back()}catch(c){h.error(c.response?.data?.error||"密码修改失败")}finally{v.value=!1}};return(c,e)=>{const q=t("n-icon"),R=t("n-alert"),f=t("n-input"),w=t("n-form-item"),b=t("n-button"),Z=t("n-space"),j=t("n-form"),A=t("n-divider"),D=t("n-card");return m(),U("div",H,[r(D,{class:"change-password-card"},{header:o(()=>[a("div",J,[r(q,{size:"24",color:"#f0a020"},{default:o(()=>[r(E(G))]),_:1}),a("span",null,O(i.value?"首次登录 - 修改默认密码":"修改密码"),1)])]),default:o(()=>[i.value?(m(),x(R,{key:0,type:"warning",style:{"margin-bottom":"20px"}},{default:o(()=>[...e[4]||(e[4]=[_(" 检测到您正在使用默认密码，为了账户安全，请立即修改密码。 ",-1)])]),_:1})):C("",!0),r(j,{ref_key:"formRef",ref:k,model:s.value,rules:V,"label-placement":"left","label-width":"100"},{default:o(()=>[r(w,{label:"当前密码",path:"oldPassword"},{default:o(()=>[r(f,{value:s.value.oldPassword,"onUpdate:value":e[0]||(e[0]=n=>s.value.oldPassword=n),type:"password",placeholder:"请输入当前密码","show-password-on":"click"},null,8,["value"])]),_:1}),r(w,{label:"新密码",path:"newPassword"},{default:o(()=>[r(f,{value:s.value.newPassword,"onUpdate:value":e[1]||(e[1]=n=>s.value.newPassword=n),type:"password",placeholder:"至少8位，含大小写字母和数字","show-password-on":"click"},null,8,["value"])]),_:1}),r(w,{label:"确认密码",path:"confirmPassword"},{default:o(()=>[r(f,{value:s.value.confirmPassword,"onUpdate:value":e[2]||(e[2]=n=>s.value.confirmPassword=n),type:"password",placeholder:"请再次输入新密码","show-password-on":"click",onKeyup:K(y,["enter"])},null,8,["value"])]),_:1}),r(w,null,{default:o(()=>[r(Z,null,{default:o(()=>[r(b,{type:"primary",loading:v.value,onClick:y},{default:o(()=>[...e[5]||(e[5]=[_(" 确认修改 ",-1)])]),_:1},8,["loading"]),i.value?C("",!0):(m(),x(b,{key:0,onClick:e[3]||(e[3]=n=>E(d).back())},{default:o(()=>[...e[6]||(e[6]=[_(" 取消 ",-1)])]),_:1}))]),_:1})]),_:1})]),_:1},8,["model"]),r(A),a("div",Q,[e[7]||(e[7]=a("h4",null,"密码要求：",-1)),a("ul",null,[a("li",{class:p({valid:B.value})},"至少 8 个字符",2),a("li",{class:p({valid:L.value})},"包含大写字母 (A-Z)",2),a("li",{class:p({valid:M.value})},"包含小写字母 (a-z)",2),a("li",{class:p({valid:N.value})},"包含数字 (0-9)",2)])])]),_:1})])}}}),ue=X(ee,[["__scopeId","data-v-9e9cf578"]]);export{ue as default};
