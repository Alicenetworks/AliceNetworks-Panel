import{aj as re,i as ue,ak as pe,al as ve,am as fe,an as V,ao as ye,ap as me,aq as ce}from"./index-ZJAELyGg.js";import{T as ge,E as we}from"./TableSkeleton-CpNcW2pL.js";import{u as ke,f as Ce,g,B as d,e as S}from"./naive-ui-B4L8VU6X.js";import{k as _e,o as be,Z as he,Y as t,W as a,r as i,V as p,X as T,j as r,U as A,N as u,a2 as G,c as xe,m as v}from"./vue-vendor-CGi32OHI.js";import"./index-3OKNQTir.js";import"./SwapHorizontalOutline-BSqMGymv.js";import"./ServerOutline-CH8la6EY.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const Pe={class:"proxy-chains"},Be=_e({__name:"ProxyChains",setup(Se){const s=ke(),j=Ce(),w=i(!1),U=i(!1),z=i(!1),H=i(!1),b=i([]),k=i([]),D=i([]),y=i(!1),h=i(!1),C=i(!1),N=i(!1),$=i(""),_=i(null),m=i(null),I=[{label:"SOCKS5 代理",value:"socks5"},{label:"HTTP 代理",value:"http"},{label:"TCP 转发",value:"tcp"},{label:"UDP 转发",value:"udp"}],M=()=>({name:"",description:"",listen_addr:":1080",listen_type:"socks5",target_addr:"",enabled:!0}),o=i(M()),c=i({node_id:null}),J=xe(()=>{const l=new Set(k.value.map(e=>e.node_id));return D.value.filter(e=>!l.has(e.id)).map(e=>({label:`${e.name} (${e.host}:${e.port}) - ${e.protocol}`,value:e.id}))}),L=[{title:"ID",key:"id",width:60},{title:"名称",key:"name",width:150},{title:"描述",key:"description",ellipsis:{tooltip:!0}},{title:"监听",key:"listen_addr",width:100},{title:"类型",key:"listen_type",width:100,render:l=>v(S,{type:"info",size:"small"},()=>l.listen_type?.toUpperCase()||"SOCKS5")},{title:"状态",key:"enabled",width:80,render:l=>v(S,{type:l.enabled?"success":"default",size:"small"},()=>l.enabled?"启用":"禁用")},{title:"操作",key:"actions",width:280,render:l=>v(g,{size:"small"},()=>[v(d,{size:"small",onClick:()=>X(l)},()=>"编辑"),v(d,{size:"small",type:"primary",onClick:()=>Q(l)},()=>"跳点"),v(d,{size:"small",onClick:()=>ae(l)},()=>"配置"),v(d,{size:"small",type:"error",onClick:()=>Z(l)},()=>"删除")])}],R=[{title:"顺序",key:"hop_order",width:60,render:l=>l.hop_order+1},{title:"节点名称",key:"node.name",width:150,render:l=>l.node?.name||"-"},{title:"地址",key:"node.host",render:l=>l.node?`${l.node.host}:${l.node.port}`:"-"},{title:"协议",key:"node.protocol",width:100,render:l=>l.node?.protocol||"socks5"},{title:"状态",key:"node.status",width:80,render:l=>v(S,{type:l.node?.status==="online"?"success":"default",size:"small"},()=>l.node?.status==="online"?"在线":"离线")},{title:"启用",key:"enabled",width:80,render:l=>v(S,{type:l.enabled?"success":"default",size:"small"},()=>l.enabled?"是":"否")},{title:"操作",key:"actions",width:100,render:l=>v(d,{size:"small",type:"error",onClick:()=>te(l)},()=>"移除")}],O=async()=>{w.value=!0;try{const l=await re();b.value=l||[]}catch{s.error("加载隧道列表失败")}finally{w.value=!1}},W=async()=>{try{const l=await ue();D.value=l||[]}catch(l){console.error("Failed to load nodes",l)}},E=()=>{o.value=M(),_.value=null,y.value=!0},X=l=>{_.value=l,o.value={...M(),...l},y.value=!0},Y=async()=>{if(!o.value.name){s.error("请输入名称");return}if(!o.value.listen_addr){s.error("请输入监听地址");return}U.value=!0;try{_.value?(await pe(_.value.id,o.value),s.success("隧道已更新")):(await ve(o.value),s.success("隧道已创建")),y.value=!1,O()}catch(l){s.error(l.response?.data?.error||"保存失败")}finally{U.value=!1}},Z=l=>{j.warning({title:"删除隧道",content:`确定要删除隧道 "${l.name}" 吗？`,positiveText:"删除",negativeText:"取消",onPositiveClick:async()=>{try{await me(l.id),s.success("隧道已删除"),O()}catch{s.error("删除失败")}}})},Q=async l=>{m.value=l,h.value=!0,z.value=!0;try{const e=await V(l.id);k.value=e||[]}catch{s.error("加载跳点失败")}finally{z.value=!1}},ee=()=>{c.value={node_id:null},C.value=!0},le=async()=>{if(!c.value.node_id){s.error("请选择节点");return}H.value=!0;try{await fe(m.value.id,{node_id:c.value.node_id,enabled:!0}),s.success("跳点已添加"),C.value=!1;const l=await V(m.value.id);k.value=l||[]}catch(l){s.error(l.response?.data?.error||"添加失败")}finally{H.value=!1}},te=async l=>{j.warning({title:"移除跳点",content:`确定要移除节点 "${l.node?.name}" 吗？`,positiveText:"移除",negativeText:"取消",onPositiveClick:async()=>{try{await ye(m.value.id,l.id),s.success("跳点已移除");const e=await V(m.value.id);k.value=e||[]}catch{s.error("移除失败")}}})},ae=async l=>{try{const e=await ce(l.id);$.value=typeof e=="string"?e:JSON.stringify(e,null,2),N.value=!0}catch{s.error("获取配置失败")}},ne=()=>{navigator.clipboard.writeText($.value),s.success("已复制到剪贴板")};return be(()=>{O(),W()}),(l,e)=>{const B=p("n-alert"),q=p("n-data-table"),oe=p("n-card"),x=p("n-input"),f=p("n-form-item"),F=p("n-select"),se=p("n-switch"),K=p("n-form"),P=p("n-modal"),ie=p("n-code"),de=p("n-scrollbar");return T(),he("div",Pe,[t(oe,null,{header:a(()=>[t(u(g),{justify:"space-between",align:"center"},{default:a(()=>[e[15]||(e[15]=G("span",null,"隧道转发 / 代理链",-1)),t(u(d),{type:"primary",onClick:E},{default:a(()=>[...e[14]||(e[14]=[r(" 添加隧道 ",-1)])]),_:1})]),_:1})]),default:a(()=>[t(B,{type:"info",style:{"margin-bottom":"16px"}},{default:a(()=>[...e[16]||(e[16]=[r(" 隧道转发支持多跳代理链：用户 → 国内VPS(中转) → 国外VPS(落地) → 目标网站 ",-1)])]),_:1}),w.value&&b.value.length===0?(T(),A(ge,{key:0,rows:3})):!w.value&&b.value.length===0?(T(),A(we,{key:1,type:"tunnels","action-text":"添加隧道",onAction:E})):(T(),A(q,{key:2,columns:L,data:b.value,loading:w.value,"row-key":n=>n.id},null,8,["data","loading","row-key"]))]),_:1}),t(P,{show:y.value,"onUpdate:show":e[7]||(e[7]=n=>y.value=n),preset:"dialog",title:_.value?"编辑隧道":"添加隧道",style:{width:"600px"}},{action:a(()=>[t(u(g),null,{default:a(()=>[t(u(d),{onClick:e[6]||(e[6]=n=>y.value=!1)},{default:a(()=>[...e[19]||(e[19]=[r("取消",-1)])]),_:1}),t(u(d),{type:"primary",loading:U.value,onClick:Y},{default:a(()=>[...e[20]||(e[20]=[r("保存",-1)])]),_:1},8,["loading"])]),_:1})]),default:a(()=>[t(K,{model:o.value,"label-placement":"left","label-width":"100"},{default:a(()=>[t(f,{label:"名称",required:""},{default:a(()=>[t(x,{value:o.value.name,"onUpdate:value":e[0]||(e[0]=n=>o.value.name=n),placeholder:"例如: HK-US隧道"},null,8,["value"])]),_:1}),t(f,{label:"描述"},{default:a(()=>[t(x,{value:o.value.description,"onUpdate:value":e[1]||(e[1]=n=>o.value.description=n),placeholder:"隧道用途说明"},null,8,["value"])]),_:1}),t(f,{label:"监听地址",required:""},{default:a(()=>[t(x,{value:o.value.listen_addr,"onUpdate:value":e[2]||(e[2]=n=>o.value.listen_addr=n),placeholder:"例如: :1080"},{prefix:a(()=>[...e[17]||(e[17]=[r("本地端口",-1)])]),_:1},8,["value"])]),_:1}),t(f,{label:"监听类型"},{default:a(()=>[t(F,{value:o.value.listen_type,"onUpdate:value":e[3]||(e[3]=n=>o.value.listen_type=n),options:I},null,8,["value"])]),_:1}),t(f,{label:"目标地址"},{default:a(()=>[t(x,{value:o.value.target_addr,"onUpdate:value":e[4]||(e[4]=n=>o.value.target_addr=n),placeholder:"留空则使用代理模式，填写则为端口转发"},{prefix:a(()=>[...e[18]||(e[18]=[r("可选",-1)])]),_:1},8,["value"])]),_:1}),t(f,{label:"启用"},{default:a(()=>[t(se,{value:o.value.enabled,"onUpdate:value":e[5]||(e[5]=n=>o.value.enabled=n)},null,8,["value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["show","title"]),t(P,{show:h.value,"onUpdate:show":e[9]||(e[9]=n=>h.value=n),preset:"dialog",title:`管理跳点: ${m.value?.name}`,style:{width:"850px"}},{action:a(()=>[t(u(d),{onClick:e[8]||(e[8]=n=>h.value=!1)},{default:a(()=>[...e[24]||(e[24]=[r("关闭",-1)])]),_:1})]),default:a(()=>[t(u(g),{vertical:"",size:"large"},{default:a(()=>[t(B,{type:"info"},{default:a(()=>[...e[21]||(e[21]=[r(" 按顺序添加代理节点，流量将依次经过每个节点。例如：用户 → 节点1(国内中转) → 节点2(国外落地) → 目标 ",-1)])]),_:1}),t(u(g),{justify:"space-between",align:"center"},{default:a(()=>[e[23]||(e[23]=G("span",null,"跳点列表 (按顺序转发)",-1)),t(u(d),{type:"primary",size:"small",onClick:ee},{default:a(()=>[...e[22]||(e[22]=[r(" 添加跳点 ",-1)])]),_:1})]),_:1}),t(q,{columns:R,data:k.value,loading:z.value,"row-key":n=>n.id,size:"small","max-height":"400"},null,8,["data","loading","row-key"])]),_:1})]),_:1},8,["show","title"]),t(P,{show:C.value,"onUpdate:show":e[12]||(e[12]=n=>C.value=n),preset:"dialog",title:"添加跳点",style:{width:"500px"}},{action:a(()=>[t(u(g),null,{default:a(()=>[t(u(d),{onClick:e[11]||(e[11]=n=>C.value=!1)},{default:a(()=>[...e[25]||(e[25]=[r("取消",-1)])]),_:1}),t(u(d),{type:"primary",loading:H.value,onClick:le},{default:a(()=>[...e[26]||(e[26]=[r("添加",-1)])]),_:1},8,["loading"])]),_:1})]),default:a(()=>[t(K,{model:c.value,"label-placement":"left","label-width":"100"},{default:a(()=>[t(f,{label:"选择节点"},{default:a(()=>[t(F,{value:c.value.node_id,"onUpdate:value":e[10]||(e[10]=n=>c.value.node_id=n),options:J.value,filterable:"",placeholder:"选择要添加的节点"},null,8,["value","options"])]),_:1})]),_:1},8,["model"])]),_:1},8,["show"]),t(P,{show:N.value,"onUpdate:show":e[13]||(e[13]=n=>N.value=n),preset:"dialog",title:"GOST 配置",style:{width:"750px"}},{action:a(()=>[t(u(d),{onClick:ne},{default:a(()=>[...e[28]||(e[28]=[r("复制配置",-1)])]),_:1})]),default:a(()=>[t(B,{type:"info",style:{"margin-bottom":"16px"}},{default:a(()=>[...e[27]||(e[27]=[r(" 将此配置保存到 GOST 配置文件即可启用多跳隧道转发 ",-1)])]),_:1}),t(de,{style:{"max-height":"400px"}},{default:a(()=>[t(ie,{code:$.value,language:"yaml","word-wrap":""},null,8,["code"])]),_:1})]),_:1},8,["show"])])}}});export{Be as default};
